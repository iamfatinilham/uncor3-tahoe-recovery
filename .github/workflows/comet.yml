name: Latest Beta (Wallpapers, Fonts, Sounds) Extractor

on:
  workflow_dispatch:

jobs:
  extract:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4

      # 1. Free up disk space (less critical now, but good practice)
      - name: Maximize Build Space
        run: |
          sudo rm -rf /usr/local/lib/android
          sudo rm -rf /Users/runner/Library/Android
          sudo rm -rf /Users/runner/.dotnet
          
      # 2. Locate and copy target directories
      - name: Copy Wallpapers, Fonts, and Sounds
        run: |
          # --- Paths in macOS ---
          # Wallpapers are in /Library/Desktop Pictures
          # Fonts are in /System/Library/Fonts and /Library/Fonts
          # Sounds are in /System/Library/Sounds and /Library/Sounds
          
          OUTPUT_DIR="./Extracted-Assets"
          mkdir -p "$OUTPUT_DIR"
          
          # Copy Wallpapers
          echo "Copying Wallpapers..."
          cp -R "/Library/Desktop Pictures" "$OUTPUT_DIR/Wallpapers"
          
          # Copy Fonts (including Apple Color Emoji)
          echo "Copying Fonts (System and Library)..."
          mkdir -p "$OUTPUT_DIR/Fonts"
          cp -R "/System/Library/Fonts" "$OUTPUT_DIR/Fonts/System"
          cp -R "/Library/Fonts" "$OUTPUT_DIR/Fonts/Library"
          
          # Copy Sounds
          echo "Copying Sounds (System and Library)..."
          mkdir -p "$OUTPUT_DIR/Sounds"
          cp -R "/System/Library/Sounds" "$OUTPUT_DIR/Sounds/System"
          cp -R "/Library/Sounds" "$OUTPUT_DIR/Sounds/Library"

      # 3. Zip the extracted content
      - name: Package Extracted Assets into ZIP
        run: |
          ASSET_NAME="Tahoe-Assets-$(date +'%Y-%m-%d-%H-%M-%S')_run_${{ github.run_number }}"
          ZIP_FILE="$ASSET_NAME.zip"
          echo "ASSET_NAME=$ASSET_NAME" >> $GITHUB_ENV
          echo "Zipping content to $ZIP_FILE..."
          zip -r "$ZIP_FILE" ./Extracted-Assets

      # 4. Export as artifact
      - name: Upload Extracted Assets ZIP
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.ASSET_NAME }}
          path: ${{ env.ASSET_NAME }}.zip
          compression-level: 9
